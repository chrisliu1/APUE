#include "ls.h"

void BubbleSort(FileLink head);
void ls_with_c()
{
	struct dirent* dirp;
	DIR *dp;
	struct stat statbuf;
	//get head node
	FileLink head = initList();
	FileLink p;
	FileLink tail = NULL;
	if( (dp = opendir(dir.dirpath)) == NULL)
		fprintf(stderr, "Can't open %s\n", dir.dirpath);

	while( (dirp = readdir(dp)) != NULL){
		if(stat(dirp->d_name, &statbuf) < 0)
			fprintf(stderr, "%s: stat error", dirp->d_name);
		if(dirp->d_name[0] == '.'){
			continue;
		}
		else{
			p = (FileLink)malloc(sizeof(fileNode));
			strcat(p->filename, dirp->d_name);
			p->actime = statbuf.st_atime;
			p->next = head->next;
			head->next = p;
		}
	}	
	BubbleSort(head);
	p = head->next;
	while(p->next != NULL){
		fprintf(stdout, "%s %d\n", p->filename, p->actime);
		p = p->next;
	}
	fprintf(stdout, "\n");
}

void BubbleSort(FileLink head)
{
	FileLink p, prep, tail;
	prep = head;
	p = head->next;
	
	while(p->next != tail){
		if(p->actime < p->next->actime){
			prep->next = p->next;
			p->next = p->next->next;
			prep->next->next = p;
		}
	p = p->next;
	prep = prep->next;
	}
	tail = p;
}
